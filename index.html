<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"qinghe7.github.io","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="选择有时候比努力更重要">
<meta property="og:type" content="website">
<meta property="og:title" content="Qinghe&#39;Blog">
<meta property="og:url" content="https://qinghe7.github.io/index.html">
<meta property="og:site_name" content="Qinghe&#39;Blog">
<meta property="og:description" content="选择有时候比努力更重要">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Qinghe">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://qinghe7.github.io/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Qinghe'Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Qinghe'Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">你好，陌生人</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://qinghe7.github.io/2023/08/30/k8s&docker/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/saber.png">
      <meta itemprop="name" content="Qinghe">
      <meta itemprop="description" content="选择有时候比努力更重要">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Qinghe'Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/08/30/k8s&docker/" class="post-title-link" itemprop="url">k8s & docker</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-08-30 16:09:33 / 修改时间：16:20:22" itemprop="dateCreated datePublished" datetime="2023-08-30T16:09:33+08:00">2023-08-30</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">分布式</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>4.8k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>4 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Docker-和-Kubernetes（k8s）"><a href="#Docker-和-Kubernetes（k8s）" class="headerlink" title="Docker 和 Kubernetes（k8s）"></a>Docker 和 Kubernetes（k8s）</h1><p>Docker 和 Kubernetes（k8s）都是容器化技术的关键组件，但它们在容器生态系统中起到不同的作用。</p>
<h3 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h3><p><img src="https://picx.zhimg.com/80/v2-1e812120a0cfbb4c5f507e8c1c3425f5_720w.webp?source=1940ef5c"></p>
<ol>
<li>Docker 是一种<a target="_blank" rel="noopener" href="https://www.zhihu.com/search?q=%E5%AE%B9%E5%99%A8%E6%8A%80%E6%9C%AF&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22:%22answer%22,%22sourceId%22:2947869624%7D">容器技术</a>，它允许开发者将应用程序及其依赖项打包到一个容器中。这有助于实现应用程序的隔离和一致性。</li>
<li>Docker 提供了一个轻量级的虚拟化方式，让应用程序在不同环境中以相同的方式运行，从而简化了开发、测试和部署过程。</li>
<li>Docker 主要关注单个容器的创建、管理和运行。</li>
</ol>
<h3 id="Kubernetes（k8s）："><a href="#Kubernetes（k8s）：" class="headerlink" title="Kubernetes（k8s）："></a>Kubernetes（k8s）：</h3><p><img src="https://picx.zhimg.com/80/v2-65c12dabdb815abcf7a1ef5034db6dce_720w.webp?source=1940ef5c"></p>
<ol>
<li>Kubernetes 是一个容器编排平台，用于自动化容器部署、扩展和管理。它的主要目标是简化大规模容器应用程序的管理。</li>
<li>Kubernetes 能够在多个节点上调度、管理和扩展容器，实现容器的<a target="_blank" rel="noopener" href="https://www.zhihu.com/search?q=%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22:%22answer%22,%22sourceId%22:2947869624%7D">负载均衡</a>和自动恢复。</li>
<li>Kubernetes 提供了一整套功能，如<a target="_blank" rel="noopener" href="https://www.zhihu.com/search?q=%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22:%22answer%22,%22sourceId%22:2947869624%7D">服务发现</a>、存储管理、自动扩容、滚动更新等，以支持容器应用程序的生命周期管理。</li>
</ol>
<p>总结起来，Docker 是一种容器技术，用于将应用程序及其依赖项封装到单独的容器中。而 Kubernetes 是一个容器编排和管理平台，用于部署和管理大规模的容器化应用程序。这两个技术互补，通常一起使用以实现现代、可扩展的应用程序部署。</p>
<h2 id="一、初识Docker"><a href="#一、初识Docker" class="headerlink" title="一、初识Docker"></a>一、初识Docker</h2><h2 id="1-1-什么是Docker"><a href="#1-1-什么是Docker" class="headerlink" title="1.1.什么是Docker"></a>1.1.什么是Docker</h2><p><a target="_blank" rel="noopener" href="https://www.zhihu.com/search?q=%E5%BE%AE%E6%9C%8D%E5%8A%A1&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22:%22answer%22,%22sourceId%22:2947869624%7D">微服务</a>虽然具备各种各样的优势，但服务的拆分通用给部署带来了很大的麻烦。</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.zhihu.com/search?q=%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22:%22answer%22,%22sourceId%22:2947869624%7D">分布式系统</a>中，依赖的组件非常多，不同组件之间部署时往往会产生一些冲突。</li>
<li>在数百上千台服务中重复部署，环境不一定一致，会遇到各种问题</li>
</ul>
<h3 id="1-1-1-应用部署的环境问题"><a href="#1-1-1-应用部署的环境问题" class="headerlink" title="1.1.1.应用部署的环境问题"></a>1.1.1.应用部署的环境问题</h3><p>大型项目组件较多，运行环境也较为复杂，部署时会碰到一些问题：</p>
<ul>
<li>依赖关系复杂，容易出现兼容性问题</li>
<li>开发、测试、生产环境有差异</li>
</ul>
<p><img src="https://pic1.zhimg.com/80/v2-2e77c5d82dd9b55bcc586c7dbcd63886_720w.webp?source=1940ef5c"></p>
<p>例如一个项目中，部署时需要依赖于<a target="_blank" rel="noopener" href="https://www.zhihu.com/search?q=node.js&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22:%22answer%22,%22sourceId%22:2490748104%7D">node.js</a>、Redis、RabbitMQ、MySQL等，这些服务部署时所需要的<a target="_blank" rel="noopener" href="https://www.zhihu.com/search?q=%E5%87%BD%E6%95%B0%E5%BA%93&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22:%22answer%22,%22sourceId%22:2490748104%7D">函数库</a>、依赖项各不相同，甚至会有冲突。给部署带来了极大的困难。</p>
<h3 id="1-1-2-Docker解决依赖兼容问题"><a href="#1-1-2-Docker解决依赖兼容问题" class="headerlink" title="1.1.2.Docker解决依赖兼容问题"></a>1.1.2.Docker解决依赖兼容问题</h3><p>而Docker确巧妙的解决了这些问题，Docker是如何实现的呢？</p>
<p>Docker为了解决依赖的兼容问题的，采用了两个手段：</p>
<ul>
<li>将应用的Libs（函数库）、Deps（依赖）、配置与应用一起打包</li>
<li>将每个应用放到一个隔离<strong>容器</strong>去运行，避免互相干扰</li>
</ul>
<p><img src="https://picx.zhimg.com/80/v2-75b4b89f4920dfb5b9542dcc185e8076_720w.webp?source=1940ef5c"></p>
<p>​</p>
<p>这样打包好的应用包中，既包含应用本身，也保护应用所需要的Libs、Deps，无需再操作系统上安装这些，自然就不存在不同应用之间的兼容问题了。</p>
<p>虽然解决了不同应用的兼容问题，但是开发、测试等环境会存在差异，操作系统版本也会有差异，怎么解决这些问题呢？</p>
<h3 id="1-1-3-Docker解决操作系统环境差异"><a href="#1-1-3-Docker解决操作系统环境差异" class="headerlink" title="1.1.3.Docker解决操作系统环境差异"></a>1.1.3.Docker解决操作系统环境差异</h3><p>要解决不同操作系统环境差异问题，必须先了解操作系统结构。以一个Ubuntu操作系统为例，结构如下：</p>
<p><img src="https://pic1.zhimg.com/80/v2-5c4cab6ffb62a4cd1633a495776bb1d8_720w.webp?source=1940ef5c"></p>
<p>结构包括：</p>
<ul>
<li>计算机硬件：例如CPU、内存、磁盘等</li>
<li>系统内核：所有Linux发行版的内核都是Linux，例如CentOS、Ubuntu、Fedora等。内核可以与计算机硬件交互，对外提供<strong>内核指令</strong>，用于操作计算机硬件。</li>
<li>系统应用：操作系统本身提供的应用、函数库。这些函数库是对内核指令的封装，使用更加方便。</li>
</ul>
<p>应用于计算机交互的流程如下：</p>
<p>1）应用调用操作系统应用（函数库），实现各种功能</p>
<p>2）系统函数库是对内核<a target="_blank" rel="noopener" href="https://www.zhihu.com/search?q=%E6%8C%87%E4%BB%A4%E9%9B%86&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22:%22answer%22,%22sourceId%22:2947869624%7D">指令集</a>的封装，会调用内核指令</p>
<p>3）内核指令操作计算机硬件</p>
<p>Ubuntu和CentOSpringBoot都是基于Linux内核，无非是系统应用不同，提供的函数库有差异：</p>
<p><img src="https://picx.zhimg.com/80/v2-ca6150cd75bd9d24b95fe501e83be9e3_720w.webp?source=1940ef5c"></p>
<p>​</p>
<p>此时，如果将一个Ubuntu版本的MySQL应用安装到CentOS系统，MySQL在调用Ubuntu函数库时，会发现找不到或者不匹配，就会报错了：</p>
<p><img src="https://pica.zhimg.com/80/v2-35e4cf5232197cffee0a3cc3a85424cd_720w.webp?source=1940ef5c"></p>
<p>​  </p>
<p>Docker如何解决不同系统环境的问题？</p>
<ul>
<li>Docker将<a target="_blank" rel="noopener" href="https://www.zhihu.com/search?q=%E7%94%A8%E6%88%B7%E7%A8%8B%E5%BA%8F&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22:%22answer%22,%22sourceId%22:2947869624%7D">用户程序</a>与所需要调用的系统(比如Ubuntu)函数库一起打包</li>
<li>Docker运行到不同操作系统时，直接基于打包的函数库，借助于操作系统的Linux内核来运行</li>
</ul>
<p>如图：</p>
<p><img src="https://picx.zhimg.com/80/v2-e27c4076481b25a3a3e3d6a9ca92140f_720w.webp?source=1940ef5c"></p>
<p>​</p>
<h3 id="1-1-4-小结"><a href="#1-1-4-小结" class="headerlink" title="1.1.4.小结"></a>1.1.4.小结</h3><p>Docker如何解决大型项目依赖关系复杂，不同组件依赖的兼容性问题？</p>
<ul>
<li>Docker允许开发中将应用、依赖、函数库、配置一起<strong>打包</strong>，形成可移植镜像</li>
<li>Docker应用运行在容器中，使用<a target="_blank" rel="noopener" href="https://www.zhihu.com/search?q=%E6%B2%99%E7%AE%B1%E6%9C%BA%E5%88%B6&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22:%22answer%22,%22sourceId%22:2947869624%7D">沙箱机制</a>，相互<strong>隔离</strong></li>
</ul>
<p>Docker如何解决开发、测试、生产环境有差异的问题？</p>
<ul>
<li>Docker镜像中包含完整运行环境，包括系统函数库，仅依赖系统的Linux内核，因此可以在任意Linux操作系统上运行</li>
</ul>
<p>Docker是一个快速交付应用、运行应用的技术，具备下列优势：</p>
<ul>
<li>可以将程序及其依赖、运行环境一起打包为一个镜像，可以迁移到任意Linux操作系统</li>
<li>运行时利用沙箱机制形成隔离容器，各个应用互不干扰</li>
<li>启动、移除都可以通过一行命令完成，方便快捷</li>
</ul>
<h3 id="1-2-Docker和虚拟机的区别"><a href="#1-2-Docker和虚拟机的区别" class="headerlink" title="1.2.Docker和虚拟机的区别"></a>1.2.Docker和<a target="_blank" rel="noopener" href="https://www.zhihu.com/search?q=%E8%99%9A%E6%8B%9F%E6%9C%BA&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22:%22answer%22,%22sourceId%22:2490748104%7D">虚拟机</a>的区别</h3><p>Docker可以让一个应用在任何操作系统中非常方便的运行。而以前我们接触的虚拟机，也能在一个操作系统中，运行另外一个操作系统，保护系统中的任何应用。</p>
<p>两者有什么差异呢？</p>
<p><strong>虚拟机</strong>（virtual machine）是在操作系统中<strong>模拟</strong>硬件设备，然后运行另一个操作系统，比如在 Windows 系统里面运行 Ubuntu 系统，这样就可以运行任意的Ubuntu应用了。</p>
<p><strong>Docker</strong>仅仅是封装函数库，并没有模拟完整的操作系统，如图：</p>
<p><img src="https://picx.zhimg.com/80/v2-e0c78bd489ddec38cdc664ca004595cd_720w.webp?source=1940ef5c"></p>
<p>对比来看：</p>
<p><img src="https://picx.zhimg.com/80/v2-3e05672812ebc72b710455da8f8c5e4c_720w.webp?source=1940ef5c"></p>
<p>​</p>
<p>小结：</p>
<p>Docker和虚拟机的差异：</p>
<ul>
<li>docker是一个系统进程；虚拟机是在操作系统中的操作系统</li>
<li>docker体积小、启动速度快、性能好；虚拟机体积大、启动速度慢、性能一般</li>
</ul>
<h3 id="1-3-Docker架构"><a href="#1-3-Docker架构" class="headerlink" title="1.3.Docker架构"></a>1.3.Docker架构</h3><h3 id="1-3-1-镜像和容器"><a href="#1-3-1-镜像和容器" class="headerlink" title="1.3.1.镜像和容器"></a>1.3.1.镜像和容器</h3><p>Docker中有几个重要的概念：</p>
<p><strong>镜像（Image）</strong>：Docker将应用程序及其所需的依赖、函数库、环境、配置等文件打包在一起，称为镜像。</p>
<p><strong>容器（Container）</strong>：镜像中的应用程序运行后形成的进程就是<strong>容器</strong>，只是Docker会给容器进程做隔离，对外不可见。</p>
<p>一切应用最终都是代码组成，都是硬盘中的一个个的字节形成的<strong>文件</strong>。只有运行时，才会加载到内存，形成进程。</p>
<p>而<strong>镜像</strong>，就是把一个应用在硬盘上的文件、及其运行环境、部分系统函数库文件一起打包形成的文件包。这个文件包是只读的。</p>
<p><strong>容器</strong>呢，就是将这些文件中编写的程序、函数加载到内存中允许，形成进程，只不过要隔离起来。因此一个镜像可以启动多次，形成多个容器进程。</p>
<p><img src="https://picx.zhimg.com/80/v2-c9ee23f955aed1f3a89a570912699790_720w.webp?source=1940ef5c"></p>
<p>​</p>
<p>例如你下载了一个QQ，如果我们将QQ在磁盘上的运行<strong>文件</strong>及其运行的操作系统依赖打包，形成QQ镜像。然后你可以启动多次，双开、甚至三开QQ，跟多个妹子聊天。</p>
<h3 id="1-3-2-DockerHub"><a href="#1-3-2-DockerHub" class="headerlink" title="1.3.2.DockerHub"></a>1.3.2.DockerHub</h3><p>开源应用程序非常多，打包这些应用往往是重复的劳动。为了避免这些重复劳动，人们就会将自己打包的应用镜像，例如Redis、MySQL镜像放到网络上，共享使用，就像GitHub的<a target="_blank" rel="noopener" href="https://www.zhihu.com/search?q=%E4%BB%A3%E7%A0%81%E5%85%B1%E4%BA%AB&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22:%22answer%22,%22sourceId%22:2947869624%7D">代码共享</a>一样。</p>
<ul>
<li>DockerHub：DockerHub是一个官方的Docker镜像的托管平台。这样的平台称为Docker Registry。</li>
<li>国内也有类似于DockerHub 的公开服务，比如 <a href="https://link.zhihu.com/?target=https://c.163yun.com/hub">网易云镜像服务</a>、<a href="https://link.zhihu.com/?target=https://cr.console.aliyun.com/">阿里云镜像库</a>等。</li>
</ul>
<p>我们一方面可以将自己的镜像共享到DockerHub，另一方面也可以从DockerHub拉取镜像：</p>
<p><img src="https://picx.zhimg.com/80/v2-447b5754d62e1ffb9d0473e430dbfd60_720w.webp?source=1940ef5c"></p>
<p>​</p>
<h3 id="1-3-3-Docker架构"><a href="#1-3-3-Docker架构" class="headerlink" title="1.3.3.Docker架构"></a>1.3.3.Docker架构</h3><p>我们要使用Docker来操作镜像、容器，就必须要安装Docker。</p>
<p>Docker是一个CS架构的程序，由两部分组成：</p>
<ul>
<li>服务端(server)：Docker<a target="_blank" rel="noopener" href="https://www.zhihu.com/search?q=%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22:%22answer%22,%22sourceId%22:2947869624%7D">守护进程</a>，负责处理Docker指令，管理镜像、容器等</li>
<li><a target="_blank" rel="noopener" href="https://www.zhihu.com/search?q=%E5%AE%A2%E6%88%B7%E7%AB%AF&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22:%22answer%22,%22sourceId%22:2490748104%7D">客户端</a>(client)：通过命令或RestAPI向Docker服务端发送指令。可以在本地或远程向服务端发送指令。</li>
</ul>
<p>如图：</p>
<p><img src="https://pica.zhimg.com/80/v2-fc9b26d4a4839236257a05eb2a8f6745_720w.webp?source=1940ef5c"></p>
<h3 id="1-3-4-小结"><a href="#1-3-4-小结" class="headerlink" title="1.3.4.小结"></a>1.3.4.小结</h3><p>镜像：</p>
<ul>
<li>将应用程序及其依赖、环境、配置打包在一起</li>
</ul>
<p>容器：</p>
<ul>
<li>镜像运行起来就是容器，一个镜像可以运行多个容器</li>
</ul>
<p>Docker结构：</p>
<ul>
<li>服务端：接收命令或远程请求，操作镜像或容器</li>
<li>客户端：发送命令或者请求到Docker服务端</li>
</ul>
<p>DockerHub：</p>
<ul>
<li>一个镜像托管的服务器，类似的还有阿里云镜像服务，统称为DockerRegistry1.4.安装Docker</li>
</ul>
<h2 id="二、-Kubernetes的概念"><a href="#二、-Kubernetes的概念" class="headerlink" title="二、 Kubernetes的概念"></a>二、 Kubernetes的概念</h2><p>Kubernetes(k8s)是一个基于容器技术的的<a target="_blank" rel="noopener" href="https://www.zhihu.com/search?q=%E5%88%86%E5%B8%83%E5%BC%8F%E6%9E%B6%E6%9E%84&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22:%22answer%22,%22sourceId%22:2947869624%7D">分布式架构</a>解决方案，是Google开源的容器集群<strong>管理系统</strong>，Google内部称为Borg,主要用于自动部署、扩展和管理容器化的应用程序，是以Docer为基础的分布式系统架构。 Kubernetes可以对分布式系统进行完美的支撑，它具备完善的集群控制能力，内建有智能的负载均衡器，拥有强大的故障发现和自我修复能力。同时还针对开发、<a target="_blank" rel="noopener" href="https://www.zhihu.com/search?q=%E9%83%A8%E7%BD%B2%E6%B5%8B%E8%AF%95&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22:%22answer%22,%22sourceId%22:2947869624%7D">部署测试</a>、运维监控等提供了完善的管理工具。</p>
<p>Kubernetes的核心思想是：一切以服务为中心，根据这一核心思想，Kubernetes可以让在其上构建的系统独立运行在物理机、虚拟机群或者云上，所以，Service（服务）是Kubernetes进行分布式集群构建的核心，必须拥有如下关键特征：</p>
<ul>
<li>拥有一个唯一指定的名称。</li>
<li>拥有一个虚拟IP和端口。</li>
<li>能够提供某种远程服务能力。</li>
<li>可以被映射到提供这种远程服务能力的一组容器应用上。</li>
</ul>
<h2 id="三、Kubernetes的术语"><a href="#三、Kubernetes的术语" class="headerlink" title="三、Kubernetes的术语"></a>三、Kubernetes的术语</h2><h3 id="3-1-Master"><a href="#3-1-Master" class="headerlink" title="3.1 Master"></a>3.1 Master</h3><p>Kubernetes的集群控制节点，负责整个集群的管理和控制，拥有一个etcd服务，用来保存所有资源对象的数据，我们执行的所有控制命令会发给他，他负责具体的执行过程，<a target="_blank" rel="noopener" href="https://www.zhihu.com/search?q=Master%E8%8A%82%E7%82%B9&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22:%22answer%22,%22sourceId%22:2704630261%7D">Master节点</a>通常会独占一个服务器，在其上会运行以上一组关键的进程：</p>
<ul>
<li><strong>Kubernetes API Server</strong>:提供Http Rest接口的关键服务进程，是Kubernetes中增、删、改、查等操作的唯一入口，是集群控制的入口进程。</li>
<li><strong>Kubernetes Controller Manager</strong>:Kubernetes中所有资源对象的自动化控制中心。</li>
<li><strong>Kubernetes Scheduler</strong>:负责资源调度的进程。</li>
</ul>
<h3 id="3-2-Node"><a href="#3-2-Node" class="headerlink" title="3.2 Node"></a>3.2 Node</h3><p><a target="_blank" rel="noopener" href="https://www.zhihu.com/search?q=Kubernetes%E9%9B%86%E7%BE%A4&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22:%22answer%22,%22sourceId%22:2704630261%7D">Kubernetes集群</a>中的其他机器被称为Node节点，Node节点可以是一台物理主机，也可以是一台虚拟机，每个Node节点会被Master节点分配一些负载，所以Node节点是Kubernetes集群中工作负载节点，当某个Node节点宕机时，工作负载会被Master自动转移到其他节点。Node节点之上会运行一组关键进程：</p>
<ul>
<li><strong>kubelet</strong>:负责Pod对应容器的创建，启动、停止等任务。</li>
<li><strong>kube-proxy</strong>:实现Kubernetes Service通讯与负载均衡机制的重要组件。</li>
<li><strong>Docker Engine</strong>:Docker引擎，负责容器的创建和管理</li>
</ul>
<h3 id="3-3-Pod"><a href="#3-3-Pod" class="headerlink" title="3.3 Pod"></a>3.3 Pod</h3><p>Pod是Kurbernetes进行创建、调度和管理的最小单位，Pod运行在Node节点之上，其中包含多个业务容器，这些业务容器之间共享网络<a target="_blank" rel="noopener" href="https://www.zhihu.com/search?q=%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22:%22answer%22,%22sourceId%22:2947869624%7D">命名空间</a>、Ip地址、端口，可以通过localhost进行通讯。Pod有两种类型：普通Pod和<a target="_blank" rel="noopener" href="https://www.zhihu.com/search?q=%E9%9D%99%E6%80%81Pod&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22:%22answer%22,%22sourceId%22:2704630261%7D">静态Pod</a>。</p>
<h3 id="3-4-Replication-Controller"><a href="#3-4-Replication-Controller" class="headerlink" title="3.4 Replication Controller"></a>3.4 Replication Controller</h3><p>Kurbernetes用来管理和保证集群中拥有的Pod。</p>
<h2 id="四、-Kubernetes的架构"><a href="#四、-Kubernetes的架构" class="headerlink" title="四、 Kubernetes的架构"></a>四、 Kubernetes的架构</h2><p>Kubernetes的一切都是基于分布式的，下面这张图就是Kubernetes的架构图</p>
<p><img src="https://picx.zhimg.com/80/v2-0c02c6e21a3b35697ad6c7baae4d9862_720w.webp?source=1940ef5c"></p>
<p>通过这张架构图我们发现Kurbernetes主要由以下几个核心组件组成：</p>
<ul>
<li><strong>Etcd</strong>:保存整个集群的状态。</li>
<li><strong>API Server</strong>:提供认证、授权、<a target="_blank" rel="noopener" href="https://www.zhihu.com/search?q=%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22:%22answer%22,%22sourceId%22:2947869624%7D">访问控制</a>、API注册和发现等机制，是资源操作的唯一入口。</li>
<li><strong>Kurbernetes Controller</strong>：负责维护集群的状态。</li>
<li><strong>Scheduler</strong>：负责资源的调度。</li>
<li>**<a target="_blank" rel="noopener" href="https://www.zhihu.com/search?q=kubelet&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22:%22answer%22,%22sourceId%22:2704630261%7D">kubelet</a>**：负责维护容器的生命周期，同时管理Volume和网络。</li>
<li><strong>Container</strong>：负责镜像管理以及Pod和容器的真正运行。</li>
<li><strong>kube-proxy</strong>：负责为Service提供cluster内部的服务发现和负载均衡。</li>
</ul>
<h1 id="docker安装部署手册"><a href="#docker安装部署手册" class="headerlink" title="docker安装部署手册"></a>docker安装部署手册</h1><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/78295209">十分钟学会用docker部署微服务 - 知乎 (zhihu.com)</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/82269806">史上最全Docker环境安装指南 - 知乎 (zhihu.com)</a> （docker 安装）</p>
<h1 id="K8S部署手册"><a href="#K8S部署手册" class="headerlink" title="K8S部署手册"></a>K8S部署手册</h1><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/627310856">kubernetes(k8s)集群超级详细超全安装部署手册 - 知乎 (zhihu.com)</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://qinghe7.github.io/2023/08/30/%E4%B8%AA%E4%BA%BA%E9%9A%8F%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/saber.png">
      <meta itemprop="name" content="Qinghe">
      <meta itemprop="description" content="选择有时候比努力更重要">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Qinghe'Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/08/30/%E4%B8%AA%E4%BA%BA%E9%9A%8F%E8%AE%B0/" class="post-title-link" itemprop="url">个人随记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-08-30 14:02:34 / 修改时间：16:11:54" itemprop="dateCreated datePublished" datetime="2023-08-30T14:02:34+08:00">2023-08-30</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E4%B8%AA%E4%BA%BA%E9%9A%8F%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">个人随记</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>127</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          Here's something encrypted, password is required to continue reading.
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2023/08/30/%E4%B8%AA%E4%BA%BA%E9%9A%8F%E8%AE%B0/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://qinghe7.github.io/2023/08/27/Tianshou/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/saber.png">
      <meta itemprop="name" content="Qinghe">
      <meta itemprop="description" content="选择有时候比努力更重要">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Qinghe'Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/08/27/Tianshou/" class="post-title-link" itemprop="url">Tianshou</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-08-27 20:22:29 / 修改时间：20:33:16" itemprop="dateCreated datePublished" datetime="2023-08-27T20:22:29+08:00">2023-08-27</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Reinforement-learning/" itemprop="url" rel="index"><span itemprop="name">Reinforement learning</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>16k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>15 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>source：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/620988786">Tianshou–强化学习算法框架学习笔记 - 知乎 (zhihu.com)</a></p>
<p><a target="_blank" rel="noopener" href="https://tianshou.readthedocs.io/en/master/tutorials/cheatsheet.html">Cheat Sheet — Tianshou 0.5.1 documentation</a></p>
<p><a target="_blank" rel="noopener" href="https://tianshou.readthedocs.io/zh/master/">欢迎查看天授平台中文文档 — 天授 0.4.6.post1 文档 (tianshou.readthedocs.io)</a></p>
<h3 id="一、Tianshou的基本框架"><a href="#一、Tianshou的基本框架" class="headerlink" title="一、Tianshou的基本框架"></a><strong>一、Tianshou的基本框架</strong></h3><p>天授（Tianshou）把一个RL训练流程划分成了几个子模块：trainer（负责训练逻辑）、collector（负责数据采集）、policy（负责训练策略）和 buffer（负责数据存储），此外还有两个外围的模块，一个是env，一个是model（policy负责RL算法实现比如loss function的计算，model就只是个正常的神经网络）。下图描述了这些模块的依赖：</p>
<p><img src="https://pic2.zhimg.com/80/v2-da45fbece6e91c073061d6b0b82ae50d_720w.webp" alt="https://pic2.zhimg.com/80/v2-da45fbece6e91c073061d6b0b82ae50d_720w.webp"></p>
<p>例子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gymnasium <span class="keyword">as</span> gym</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> tianshou <span class="keyword">as</span> ts</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br><span class="line"><span class="keyword">from</span> torch.utils.tensorboard <span class="keyword">import</span> SummaryWriter</span><br><span class="line"><span class="keyword">from</span> tianshou.utils <span class="keyword">import</span> TensorboardLogger</span><br><span class="line"> ​</span><br><span class="line"> ​</span><br><span class="line"> <span class="keyword">class</span> <span class="title class_">Net</span>(nn.Module):</span><br><span class="line">     <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, state_shape, action_shape</span>):</span><br><span class="line">         <span class="built_in">super</span>().__init__()</span><br><span class="line">         self.model = nn.Sequential(</span><br><span class="line">             nn.Linear(np.prod(state_shape), <span class="number">128</span>), nn.ReLU(inplace=<span class="literal">True</span>),</span><br><span class="line">             nn.Linear(<span class="number">128</span>, <span class="number">128</span>), nn.ReLU(inplace=<span class="literal">True</span>),</span><br><span class="line">             nn.Linear(<span class="number">128</span>, <span class="number">128</span>), nn.ReLU(inplace=<span class="literal">True</span>),</span><br><span class="line">             nn.Linear(<span class="number">128</span>, np.prod(action_shape)),</span><br><span class="line">         )</span><br><span class="line"> ​</span><br><span class="line">     <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, obs, state=<span class="literal">None</span>, info=&#123;&#125;</span>):</span><br><span class="line">         <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(obs, torch.Tensor):</span><br><span class="line">             obs = torch.tensor(obs, dtype=torch.<span class="built_in">float</span>)</span><br><span class="line">         batch = obs.shape[<span class="number">0</span>]</span><br><span class="line">         logits = self.model(obs.view(batch, -<span class="number">1</span>))</span><br><span class="line">         <span class="keyword">return</span> logits, state</span><br><span class="line"> ​</span><br><span class="line"> ​</span><br><span class="line"> <span class="comment"># Make an environment</span></span><br><span class="line"> env = gym.make(<span class="string">&#x27;CartPole-v1&#x27;</span>)</span><br><span class="line"> state_shape = env.observation_space.shape[<span class="number">0</span>]</span><br><span class="line"> action_shape = env.action_space.n</span><br><span class="line"> ​</span><br><span class="line"> <span class="comment"># Build the Network</span></span><br><span class="line"> net = Net(state_shape, action_shape)</span><br><span class="line"> optim = torch.optim.Adam(net.parameters(), lr=<span class="number">1e-3</span>)</span><br><span class="line"> ​</span><br><span class="line"> <span class="comment"># Setup Policy</span></span><br><span class="line"> policy = ts.policy.DQNPolicy(net, optim, discount_factor=<span class="number">0.9</span>, estimation_step=<span class="number">3</span>, target_update_freq=<span class="number">320</span>)</span><br><span class="line"> ​</span><br><span class="line"> <span class="comment"># Setup Collector</span></span><br><span class="line"> train_collector = ts.data.Collector(policy, env, ts.data.ReplayBuffer(<span class="number">20000</span>, <span class="number">10</span>), exploration_noise=<span class="literal">True</span>)</span><br><span class="line"> test_collector = ts.data.Collector(policy, env, exploration_noise=<span class="literal">True</span>)</span><br><span class="line"> ​</span><br><span class="line"> <span class="comment"># logging</span></span><br><span class="line"> <span class="comment"># writer = SummaryWriter(&#x27;log/dqn&#x27;)</span></span><br><span class="line"> <span class="comment"># logger = TensorboardLogger(writer)</span></span><br><span class="line"> ​</span><br><span class="line"> <span class="comment"># Train Policy with a Trainer</span></span><br><span class="line"> result = ts.trainer.offpolicy_trainer(</span><br><span class="line">     policy, train_collector, test_collector,</span><br><span class="line">     max_epoch=<span class="number">10</span>, step_per_epoch=<span class="number">10000</span>, step_per_collect=<span class="number">10</span>,</span><br><span class="line">     update_per_step=<span class="number">0.1</span>, episode_per_test=<span class="number">100</span>, batch_size=<span class="number">64</span>,</span><br><span class="line">     train_fn=<span class="keyword">lambda</span> epoch, env_step: policy.set_eps(<span class="number">0.1</span>),</span><br><span class="line">     test_fn=<span class="keyword">lambda</span> epoch, env_step: policy.set_eps(<span class="number">0.05</span>),</span><br><span class="line">     stop_fn=<span class="keyword">lambda</span> mean_rewards: mean_rewards &gt;= env.spec.reward_threshold)</span><br><span class="line"> <span class="built_in">print</span>(<span class="string">f&#x27;Finished training! Use <span class="subst">&#123;result[<span class="string">&quot;duration&quot;</span>]&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>下面，我们就将一步一步的了解上图中所有的API，对Tianshou有一个大致的了解。</p>
<h3 id="二、Batch"><a href="#二、Batch" class="headerlink" title="二、Batch"></a><strong>二、Batch</strong></h3><p>下面我们首先来看看Batch这个数据结构：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> tianshou.data <span class="keyword">import</span> Batch</span><br><span class="line">data = Batch(a=<span class="number">4</span>, b=[<span class="number">5</span>, <span class="number">5</span>], c=<span class="string">&#x27;2312312&#x27;</span>, d=(<span class="string">&#x27;a&#x27;</span>, -<span class="number">2</span>, -<span class="number">3</span>))</span><br><span class="line"><span class="built_in">print</span>(data)</span><br><span class="line"><span class="built_in">print</span>(data.b)</span><br><span class="line">​</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Batch(</span></span><br><span class="line"><span class="string">    a: array(4),</span></span><br><span class="line"><span class="string">    b: array([5, 5]),</span></span><br><span class="line"><span class="string">    c: &#x27;2312312&#x27;,</span></span><br><span class="line"><span class="string">    d: array([&#x27;a&#x27;, &#x27;-2&#x27;, &#x27;-3&#x27;], dtype=object),</span></span><br><span class="line"><span class="string">)</span></span><br><span class="line"><span class="string">[5 5]</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<p>可以发现，batch类似于dict，存储key-value对，并且可以自动将value转化成numpy array。</p>
<p>下面例子演示Batch存储numpy和pytorch的数据：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line">batch1 = Batch(a=np.arange(<span class="number">2</span>), b=torch.zeros((<span class="number">2</span>,<span class="number">2</span>)))</span><br><span class="line">batch2 = Batch(a=np.arange(<span class="number">2</span>), b=torch.ones((<span class="number">2</span>,<span class="number">2</span>)))</span><br><span class="line">batch_cat = Batch.cat([batch1, batch2, batch1])</span><br><span class="line"><span class="built_in">print</span>(batch1)</span><br><span class="line"><span class="built_in">print</span>(batch2)</span><br><span class="line"><span class="built_in">print</span>(batch_cat)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Batch(</span></span><br><span class="line"><span class="string">    a: array([0, 1]),</span></span><br><span class="line"><span class="string">    b: tensor([[0., 0.],</span></span><br><span class="line"><span class="string">               [0., 0.]]),</span></span><br><span class="line"><span class="string">)</span></span><br><span class="line"><span class="string">Batch(</span></span><br><span class="line"><span class="string">    a: array([0, 1]),</span></span><br><span class="line"><span class="string">    b: tensor([[1., 1.],</span></span><br><span class="line"><span class="string">               [1., 1.]]),</span></span><br><span class="line"><span class="string">)</span></span><br><span class="line"><span class="string">Batch(</span></span><br><span class="line"><span class="string">    b: tensor([[0., 0.],</span></span><br><span class="line"><span class="string">               [0., 0.],</span></span><br><span class="line"><span class="string">               [1., 1.],</span></span><br><span class="line"><span class="string">               [1., 1.],</span></span><br><span class="line"><span class="string">               [0., 0.],</span></span><br><span class="line"><span class="string">               [0., 0.]]),</span></span><br><span class="line"><span class="string">    a: array([0, 1, 0, 1, 0, 1]),</span></span><br><span class="line"><span class="string">)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<p>将Batch中的数据类型统一转换成numpy或pytorch的数据类型：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">batch_cat.to_numpy()</span><br><span class="line"><span class="built_in">print</span>(batch_cat)</span><br><span class="line">batch_cat.to_torch()</span><br><span class="line"><span class="built_in">print</span>(batch_cat)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Batch(</span></span><br><span class="line"><span class="string">    a: array([0, 1, 0, 1, 0, 1]),</span></span><br><span class="line"><span class="string">    b: array([[0., 0.],</span></span><br><span class="line"><span class="string">              [0., 0.],</span></span><br><span class="line"><span class="string">              [1., 1.],</span></span><br><span class="line"><span class="string">              [1., 1.],</span></span><br><span class="line"><span class="string">              [0., 0.],</span></span><br><span class="line"><span class="string">              [0., 0.]], dtype=float32),</span></span><br><span class="line"><span class="string">)</span></span><br><span class="line"><span class="string">Batch(</span></span><br><span class="line"><span class="string">    a: tensor([0, 1, 0, 1, 0, 1]),</span></span><br><span class="line"><span class="string">    b: tensor([[0., 0.],</span></span><br><span class="line"><span class="string">               [0., 0.],</span></span><br><span class="line"><span class="string">               [1., 1.],</span></span><br><span class="line"><span class="string">               [1., 1.],</span></span><br><span class="line"><span class="string">               [0., 0.],</span></span><br><span class="line"><span class="string">               [0., 0.]]),</span></span><br><span class="line"><span class="string">)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="三、ReplayBuffer"><a href="#三、ReplayBuffer" class="headerlink" title="三、ReplayBuffer"></a><strong>三、ReplayBuffer</strong></h3><p>Replay buffer在RL的off-policy中非常常用，其可以存储过去的经验，以便训练我们的agent。</p>
<p>在Tianshou中，可以把replay buffer看成一种特殊的Batch。</p>
<p>下面是使用replay buffer的例子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tianshou.data <span class="keyword">import</span> Batch, ReplayBuffer</span><br><span class="line">​</span><br><span class="line"><span class="comment"># a buffer is initialised with its maxsize set to 10 (older data will be discarded if more data flow in).</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;========================================&quot;</span>)</span><br><span class="line">buf = ReplayBuffer(size=<span class="number">10</span>)</span><br><span class="line"><span class="built_in">print</span>(buf)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;maxsize: &#123;&#125;, data length: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(buf.maxsize, <span class="built_in">len</span>(buf)))</span><br><span class="line">​</span><br><span class="line"><span class="comment"># add 3 steps of data into ReplayBuffer sequentially</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;========================================&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">    buf.add(Batch(obs=i, act=i, rew=i, done=<span class="number">0</span>, obs_next=i + <span class="number">1</span>, info=&#123;&#125;))</span><br><span class="line"><span class="built_in">print</span>(buf)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;maxsize: &#123;&#125;, data length: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(buf.maxsize, <span class="built_in">len</span>(buf)))</span><br><span class="line">​</span><br><span class="line"><span class="comment"># add another 10 steps of data into ReplayBuffer sequentially</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;========================================&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>, <span class="number">13</span>):</span><br><span class="line">    buf.add(Batch(obs=i, act=i, rew=i, done=<span class="number">0</span>, obs_next=i + <span class="number">1</span>, info=&#123;&#125;))</span><br><span class="line"><span class="built_in">print</span>(buf)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;maxsize: &#123;&#125;, data length: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(buf.maxsize, <span class="built_in">len</span>(buf)))</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">========================================</span></span><br><span class="line"><span class="string">ReplayBuffer()</span></span><br><span class="line"><span class="string">maxsize: 10, data length: 0</span></span><br><span class="line"><span class="string">========================================</span></span><br><span class="line"><span class="string">ReplayBuffer(</span></span><br><span class="line"><span class="string">    info: Batch(),</span></span><br><span class="line"><span class="string">    obs_next: array([1, 2, 3, 0, 0, 0, 0, 0, 0, 0]),</span></span><br><span class="line"><span class="string">    act: array([0, 1, 2, 0, 0, 0, 0, 0, 0, 0]),</span></span><br><span class="line"><span class="string">    obs: array([0, 1, 2, 0, 0, 0, 0, 0, 0, 0]),</span></span><br><span class="line"><span class="string">    done: array([False, False, False, False, False, False, False, False, False,</span></span><br><span class="line"><span class="string">                 False]),</span></span><br><span class="line"><span class="string">    rew: array([0., 1., 2., 0., 0., 0., 0., 0., 0., 0.]),</span></span><br><span class="line"><span class="string">)</span></span><br><span class="line"><span class="string">maxsize: 10, data length: 3</span></span><br><span class="line"><span class="string">========================================</span></span><br><span class="line"><span class="string">ReplayBuffer(</span></span><br><span class="line"><span class="string">    info: Batch(),</span></span><br><span class="line"><span class="string">    obs_next: array([11, 12, 13,  4,  5,  6,  7,  8,  9, 10]),</span></span><br><span class="line"><span class="string">    act: array([10, 11, 12,  3,  4,  5,  6,  7,  8,  9]),</span></span><br><span class="line"><span class="string">    obs: array([10, 11, 12,  3,  4,  5,  6,  7,  8,  9]),</span></span><br><span class="line"><span class="string">    done: array([False, False, False, False, False, False, False, False, False,</span></span><br><span class="line"><span class="string">                 False]),</span></span><br><span class="line"><span class="string">    rew: array([10., 11., 12.,  3.,  4.,  5.,  6.,  7.,  8.,  9.]),</span></span><br><span class="line"><span class="string">)</span></span><br><span class="line"><span class="string">maxsize: 10, data length: 10</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<p>replay buffer中保留了七个属性，Tianshou推荐我们使用这七个推荐的属性，而不是自己去创建其他属性。</p>
<p><img src="https://pic3.zhimg.com/80/v2-44dbd0b48689e7816dd0701523d7d9be_720w.webp"></p>
<p>我们也看到了，buffer其实就是一种特殊的Batch，那他存在的意义是什么呢？</p>
<p>就在于可以从buffer中sample数据给到collector中，供agent进行训练。</p>
<blockquote>
<p>现在Tianshou支持gymnasium，所以又多了两个属性：truncated和terminated。</p>
</blockquote>
<p>我们还可以高效的从buffer中追踪trajectory信息。</p>
<p>下面这段代码可以获得下标为6的step所处的episode的第一个step的下标</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Search for the previous index of index &quot;6&quot;</span></span><br><span class="line">now_index = <span class="number">6</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    prev_index = buf.prev(now_index)</span><br><span class="line">    <span class="built_in">print</span>(prev_index)</span><br><span class="line">    <span class="keyword">if</span> prev_index == now_index:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        now_index = prev_index</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">5</span></span><br><span class="line"><span class="string">4</span></span><br><span class="line"><span class="string">3</span></span><br><span class="line"><span class="string">3</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<p>同理，下面代码可以返回在当前episode中下一个step的下标:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># next step of indexes [4,5,6,7,8,9] are:</span></span><br><span class="line"><span class="built_in">print</span>(buf.<span class="built_in">next</span>([<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>]))</span><br><span class="line"><span class="built_in">print</span>(buf.<span class="built_in">next</span>(<span class="number">7</span>))</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">[5 6 7 7 9 0]</span></span><br><span class="line"><span class="string">7</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<p>这在n-step-return的时候非常有用(n-step TD)</p>
<h3 id="四、Vectorized-Environment"><a href="#四、Vectorized-Environment" class="headerlink" title="四、Vectorized Environment"></a><strong>四、Vectorized Environment</strong></h3><p><img src="https://pic3.zhimg.com/80/v2-d7073830e1c3abca3458de2d42f3a37e_720w.webp"></p>
<p>在gym中，环境接收一个动作，返回下一个状态的观测和奖励。这个过程很慢，并且常常是实验的性能瓶颈，所以Tianshou利用并行环境加速这一过程。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tianshou.env <span class="keyword">import</span> SubprocVectorEnv</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> gym</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">​</span><br><span class="line">num_cpus = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">5</span>]</span><br><span class="line"><span class="keyword">for</span> num_cpu <span class="keyword">in</span> num_cpus:</span><br><span class="line">    <span class="comment"># SubprocVectorEnv这个wrapper利用多个进程，并行执行多个环境。</span></span><br><span class="line">    env = SubprocVectorEnv([<span class="keyword">lambda</span>: gym.make(<span class="string">&#x27;CartPole-v0&#x27;</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(num_cpu)])</span><br><span class="line">    env.reset()</span><br><span class="line">    sampled_steps = <span class="number">0</span></span><br><span class="line">    time_start = time.time()</span><br><span class="line">    <span class="keyword">while</span> sampled_steps &lt; <span class="number">1000</span>:</span><br><span class="line">        act = np.random.choice(<span class="number">2</span>, size=num_cpu)</span><br><span class="line">        obs, rew, done, info = env.step(act)</span><br><span class="line">        <span class="keyword">if</span> np.<span class="built_in">sum</span>(done):</span><br><span class="line">            env.reset(np.where(done)[<span class="number">0</span>])</span><br><span class="line">        sampled_steps += num_cpu</span><br><span class="line">    time_used = time.time() - time_start</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;&#123;&#125;s used to sample 1000 steps if using &#123;&#125; cpus.&quot;</span>.<span class="built_in">format</span>(time_used, num_cpu))</span><br></pre></td></tr></table></figure>

<p>下面是单个环境与多个环境的对比：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tianshou.env <span class="keyword">import</span> DummyVectorEnv</span><br><span class="line"><span class="comment"># In Gym</span></span><br><span class="line">env = gym.make(<span class="string">&quot;CartPole-v0&quot;</span>)</span><br><span class="line">​</span><br><span class="line"><span class="comment"># In Tianshou</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">helper_function</span>():</span><br><span class="line">    env = gym.make(<span class="string">&quot;CartPole-v0&quot;</span>)</span><br><span class="line">  <span class="comment"># other operations such as env.seed(np.random.choice(10))</span></span><br><span class="line">    <span class="keyword">return</span> env</span><br><span class="line">​</span><br><span class="line">envs = DummyVectorEnv([helper_function <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>)])</span><br><span class="line">​</span><br><span class="line"><span class="comment"># In Gym, env.reset() returns a single observation.</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;In Gym, env.reset() returns a single observation.&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(env.reset())</span><br><span class="line">​</span><br><span class="line"><span class="comment"># In Tianshou, envs.reset() returns stacked observations.</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;========================================&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;In Tianshou, envs.reset() returns stacked observations.&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(envs.reset())</span><br><span class="line">​</span><br><span class="line">obs, rew, done, info = envs.step(np.random.choice(<span class="number">2</span>, size=num_cpu))</span><br><span class="line"><span class="built_in">print</span>(info)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">In Gym, env.reset() returns a single observation.</span></span><br><span class="line"><span class="string">[0.04703292 0.03945684 0.03802961 0.02598534]</span></span><br><span class="line"><span class="string">========================================</span></span><br><span class="line"><span class="string">In Tianshou, envs.reset() returns stacked observations.</span></span><br><span class="line"><span class="string">[[ 0.04029649 -0.01946092 -0.02980652 -0.01614117]</span></span><br><span class="line"><span class="string"> [-0.03085166 -0.04178732 -0.02325586  0.00156881]</span></span><br><span class="line"><span class="string"> [ 0.00672287  0.04306572  0.01217845 -0.04455359]</span></span><br><span class="line"><span class="string"> [ 0.03829754  0.02683093 -0.01153483  0.04290532]</span></span><br><span class="line"><span class="string"> [ 0.04420044  0.00097068 -0.01117315  0.04102308]]</span></span><br><span class="line"><span class="string">[&#123;&#x27;env_id&#x27;: 0&#125; &#123;&#x27;env_id&#x27;: 1&#125; &#123;&#x27;env_id&#x27;: 2&#125; &#123;&#x27;env_id&#x27;: 3&#125; &#123;&#x27;env_id&#x27;: 4&#125;]</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="五、Policy"><a href="#五、Policy" class="headerlink" title="五、Policy"></a><strong>五、Policy</strong></h3><p>Policy就是agent如何做出action的\pi函数。</p>
<p>所有Policy模块都继承自BasePolicy类，并且具有相同的接口。</p>
<p>下面我们就来看看如何实现一个简单的REINFORCE的policy。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Any</span>, <span class="type">Dict</span>, <span class="type">List</span>, <span class="type">Optional</span>, <span class="type">Type</span>, <span class="type">Union</span></span><br><span class="line">​</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line">​</span><br><span class="line"><span class="keyword">from</span> tianshou.data <span class="keyword">import</span> Batch, ReplayBuffer, to_torch, to_torch_as</span><br><span class="line"><span class="keyword">from</span> tianshou.policy <span class="keyword">import</span> BasePolicy</span><br><span class="line">​</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">REINFORCEPolicy</span>(<span class="title class_ inherited__">BasePolicy</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Implementation of REINFORCE algorithm.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br></pre></td></tr></table></figure>

<p>policy最重要的两个功能就是</p>
<ol>
<li>选择动作(forward)</li>
<li>更新参数(update)，update先调用process_fn函数，处理从buffer来的数据；然后调用learn，反向传播，更新参数。</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Any</span>, <span class="type">Dict</span>, <span class="type">List</span>, <span class="type">Optional</span>, <span class="type">Type</span>, <span class="type">Union</span></span><br><span class="line">​</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line">​</span><br><span class="line"><span class="keyword">from</span> tianshou.data <span class="keyword">import</span> Batch, ReplayBuffer, to_torch, to_torch_as</span><br><span class="line"><span class="keyword">from</span> tianshou.policy <span class="keyword">import</span> BasePolicy</span><br><span class="line">​</span><br><span class="line">​</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">REINFORCEPolicy</span>(<span class="title class_ inherited__">BasePolicy</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Implementation of REINFORCE algorithm.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, model: torch.nn.Module, optim: torch.optim.Optimizer,</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.actor = model</span><br><span class="line">        self.optim = optim</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, batch: Batch</span>) -&gt; Batch:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Compute action over the given batch data.&quot;&quot;&quot;</span></span><br><span class="line">        act = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">return</span> Batch(act=act)</span><br><span class="line">​</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_fn</span>(<span class="params">self, batch: Batch, buffer: ReplayBuffer, indices: np.ndarray</span>) -&gt; Batch:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Compute the discounted returns for each transition.&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">​</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">learn</span>(<span class="params">self, batch: Batch, batch_size: <span class="built_in">int</span>, repeat: <span class="built_in">int</span></span>) -&gt; <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">List</span>[<span class="built_in">float</span>]]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Perform the back-propagation.&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span></span><br></pre></td></tr></table></figure>

<h3 id="六、Collector"><a href="#六、Collector" class="headerlink" title="六、Collector"></a><strong>六、Collector</strong></h3><p>collector与policy和环境交互，在其内部，把envs和buffer有机的结合起来，封装了其中的数据交互。</p>
<p><img src="https://pic3.zhimg.com/80/v2-1248cd71b07e48326fc65217097156f6_720w.webp"></p>
<p>Collector在训练（收集数据）时和评估策略时都可以使用。</p>
<p>Data Collecting：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tianshou.data <span class="keyword">import</span> VectorReplayBuffer</span><br><span class="line">​</span><br><span class="line">train_env_num = <span class="number">4</span></span><br><span class="line">buffer_size = <span class="number">100</span></span><br><span class="line">train_envs = DummyVectorEnv([<span class="keyword">lambda</span>: gym.make(<span class="string">&quot;CartPole-v0&quot;</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(train_env_num)])</span><br><span class="line">replaybuffer = VectorReplayBuffer(buffer_size, train_env_num)</span><br><span class="line">​</span><br><span class="line"><span class="comment"># 定义一个Collector</span></span><br><span class="line">train_collector = Collector(policy, train_envs, replaybuffer)</span><br><span class="line">​</span><br><span class="line"><span class="comment"># 利用Collector收集50个step的数据，自动存入replaybuffer中</span></span><br><span class="line">collect_result = train_collector.collect(n_step=<span class="number">50</span>)</span><br><span class="line">​</span><br><span class="line"><span class="comment"># 下面我们可以从buffer中抽样数据</span></span><br><span class="line">replaybuffer.sample(<span class="number">10</span>)</span><br></pre></td></tr></table></figure>

<p>Policy evaluation：</p>
<p>我们已经有了一个policy，现在我们想评估一下这个policy，看看reward情况等等。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gym</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line">​</span><br><span class="line"><span class="keyword">from</span> tianshou.data <span class="keyword">import</span> Collector</span><br><span class="line"><span class="keyword">from</span> tianshou.env <span class="keyword">import</span> DummyVectorEnv</span><br><span class="line"><span class="keyword">from</span> tianshou.policy <span class="keyword">import</span> PGPolicy</span><br><span class="line"><span class="keyword">from</span> tianshou.utils.net.common <span class="keyword">import</span> Net</span><br><span class="line"><span class="keyword">from</span> tianshou.utils.net.discrete <span class="keyword">import</span> Actor</span><br><span class="line">​</span><br><span class="line"><span class="keyword">import</span> warnings</span><br><span class="line">warnings.filterwarnings(<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line">​</span><br><span class="line">env = gym.make(<span class="string">&quot;CartPole-v0&quot;</span>)</span><br><span class="line">test_envs = DummyVectorEnv([<span class="keyword">lambda</span>: gym.make(<span class="string">&quot;CartPole-v0&quot;</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>)])</span><br><span class="line">​</span><br><span class="line"><span class="comment"># model</span></span><br><span class="line">net = Net(env.observation_space.shape, hidden_sizes=[<span class="number">16</span>,])</span><br><span class="line">actor = Actor(net, env.action_space.shape)</span><br><span class="line">optim = torch.optim.Adam(actor.parameters(), lr=<span class="number">0.0003</span>)</span><br><span class="line">​</span><br><span class="line">policy = PGPolicy(actor, optim, dist_fn=torch.distributions.Categorical)</span><br><span class="line">test_collector = Collector(policy, test_envs)</span><br><span class="line">​</span><br><span class="line"><span class="comment"># 收集9个episode</span></span><br><span class="line">collect_result = test_collector.collect(n_episode=<span class="number">9</span>)</span><br><span class="line"><span class="built_in">print</span>(collect_result)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">&#123;&#x27;n/ep&#x27;: 9, &#x27;n/st&#x27;: 82, &#x27;rews&#x27;: array([ 9.,  9.,  9.,  9.,  8.,  9.,  9., 11.,  9.]), &#x27;lens&#x27;: array([ 9,  9,  9,  9,  8,  9,  9, 11,  9]), &#x27;idxs&#x27;: array([0, 1, 0, 1, 0, 1, 0, 1, 0]), &#x27;rew&#x27;: 9.11111111111111, &#x27;len&#x27;: 9.11111111111111, &#x27;rew_std&#x27;: 0.7370277311900889, &#x27;len_std&#x27;: 0.7370277311900889&#125;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Rewards of 9 episodes are &#123;&#125;&quot;</span>.<span class="built_in">format</span>(collect_result[<span class="string">&quot;rews&quot;</span>]))</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Rewards of 9 episodes are [ 9.  9.  9.  9.  8.  9.  9. 11.  9.]</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Average episode reward is &#123;&#125;.&quot;</span>.<span class="built_in">format</span>(collect_result[<span class="string">&quot;rew&quot;</span>]))</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Average episode reward is 9.11111111111111.</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Average episode length is &#123;&#125;.&quot;</span>.<span class="built_in">format</span>(collect_result[<span class="string">&quot;len&quot;</span>]))</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Average episode length is 9.11111111111111.</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="七、Trainer"><a href="#七、Trainer" class="headerlink" title="七、Trainer"></a><strong>七、Trainer</strong></h3><p>Trainer是Tianshou中的顶层封装，它控制traning loop和对Policy的evaluation。Trainer控制Policy和Collector的交互。</p>
<p>Tianshou中包含三类Trainer：On-policy training, off-policy training, offline training.</p>
<p>下面是REINFORCE算法的整体流程(利用On-policy)。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gymnasium <span class="keyword">as</span> gym</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line">​</span><br><span class="line"><span class="keyword">from</span> tianshou.data <span class="keyword">import</span> Collector, VectorReplayBuffer</span><br><span class="line"><span class="keyword">from</span> tianshou.env <span class="keyword">import</span> DummyVectorEnv</span><br><span class="line"><span class="keyword">from</span> tianshou.policy <span class="keyword">import</span> PGPolicy</span><br><span class="line"><span class="keyword">from</span> tianshou.utils.net.common <span class="keyword">import</span> Net</span><br><span class="line"><span class="keyword">from</span> tianshou.utils.net.discrete <span class="keyword">import</span> Actor</span><br><span class="line">​</span><br><span class="line"><span class="keyword">import</span> warnings</span><br><span class="line">​</span><br><span class="line">warnings.filterwarnings(<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line">​</span><br><span class="line">train_env_num = <span class="number">4</span></span><br><span class="line">buffer_size = <span class="number">2000</span>  <span class="comment"># Since REINFORCE is an on-policy algorithm, we don&#x27;t need a very large buffer size</span></span><br><span class="line">​</span><br><span class="line"><span class="comment"># Create the environments, used for training and evaluation</span></span><br><span class="line">env = gym.make(<span class="string">&quot;CartPole-v1&quot;</span>)</span><br><span class="line">test_envs = DummyVectorEnv([<span class="keyword">lambda</span>: gym.make(<span class="string">&quot;CartPole-v1&quot;</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>)])</span><br><span class="line">train_envs = DummyVectorEnv([<span class="keyword">lambda</span>: gym.make(<span class="string">&quot;CartPole-v1&quot;</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(train_env_num)])</span><br><span class="line">​</span><br><span class="line"><span class="comment"># Create the Policy instance</span></span><br><span class="line">net = Net(env.observation_space.shape, hidden_sizes=[<span class="number">16</span>, ])</span><br><span class="line">actor = Actor(net, env.action_space.shape)</span><br><span class="line">optim = torch.optim.Adam(actor.parameters(), lr=<span class="number">0.001</span>)</span><br><span class="line">policy = PGPolicy(actor, optim, dist_fn=torch.distributions.Categorical)</span><br><span class="line">​</span><br><span class="line"><span class="comment"># Create the replay buffer and the collector</span></span><br><span class="line">replaybuffer = VectorReplayBuffer(buffer_size, train_env_num)</span><br><span class="line">test_collector = Collector(policy, test_envs)  <span class="comment"># 可以发现，test_collector没有replaybuffer，因为不做训练，只是测试</span></span><br><span class="line">train_collector = Collector(policy, train_envs, replaybuffer)</span><br><span class="line">​</span><br><span class="line">train_collector.reset()</span><br><span class="line">train_envs.reset()</span><br><span class="line">test_collector.reset()</span><br><span class="line">test_envs.reset()</span><br><span class="line">replaybuffer.reset()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):  <span class="comment"># 10 epoch</span></span><br><span class="line">    evaluation_result = test_collector.collect(n_episode=<span class="number">10</span>)  <span class="comment"># test_collector用来测试当前policy，得出reward。</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Evaluation reward is &#123;&#125;&quot;</span>.<span class="built_in">format</span>(evaluation_result[<span class="string">&quot;rew&quot;</span>]))</span><br><span class="line">    train_collector.collect(n_step=<span class="number">2000</span>)  <span class="comment"># 收集2000个step到replaybuffer中</span></span><br><span class="line">    <span class="comment"># 0 means taking all data stored in train_collector.buffer</span></span><br><span class="line">    policy.update(<span class="number">0</span>, train_collector.buffer, batch_size=<span class="number">512</span>, repeat=<span class="number">1</span>)  <span class="comment"># buffer中所有数据，每次batch_size为512，</span></span><br><span class="line">    train_collector.reset_buffer(keep_statistics=<span class="literal">True</span>)</span><br><span class="line">​</span><br><span class="line"><span class="comment"># 下面是使用tainer的代码：</span></span><br><span class="line">train_collector.reset()</span><br><span class="line">train_envs.reset()</span><br><span class="line">test_collector.reset()</span><br><span class="line">test_envs.reset()</span><br><span class="line">replaybuffer.reset()</span><br><span class="line">​</span><br><span class="line">result = onpolicy_trainer(</span><br><span class="line">    policy,</span><br><span class="line">    train_collector,</span><br><span class="line">    test_collector,</span><br><span class="line">    max_epoch=<span class="number">10</span>,</span><br><span class="line">    step_per_epoch=<span class="number">1</span>,  <span class="comment"># 每个epoch进行多少次transitions</span></span><br><span class="line">    repeat_per_collect=<span class="number">1</span>, <span class="comment"># the number of repeat time for policy learning, for example, set it to 2 means the policy needs to learn each given batch data twice.</span></span><br><span class="line">    episode_per_test=<span class="number">10</span>,  <span class="comment"># 每次测试进行几个episode</span></span><br><span class="line">    step_per_collect=<span class="number">2000</span>, <span class="comment"># 每次update前，收集多少step的数据</span></span><br><span class="line">    batch_size=<span class="number">512</span>,  <span class="comment"># update的时候batch的大小</span></span><br><span class="line">)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure>

<p>可以发现，trainer就是包装了一下循环。</p>
<h3 id="八、Experiment"><a href="#八、Experiment" class="headerlink" title="八、Experiment"></a><strong>八、Experiment</strong></h3><p>这一节我们用PPO来解决CartPole</p>
<p><img src="https://pic1.zhimg.com/80/v2-e0d5a938b90f41c1ddd9679ae5cad078_720w.webp"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gym</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line">​</span><br><span class="line"><span class="keyword">from</span> tianshou.data <span class="keyword">import</span> Collector, VectorReplayBuffer</span><br><span class="line"><span class="keyword">from</span> tianshou.env <span class="keyword">import</span> DummyVectorEnv</span><br><span class="line"><span class="keyword">from</span> tianshou.policy <span class="keyword">import</span> PPOPolicy</span><br><span class="line"><span class="keyword">from</span> tianshou.trainer <span class="keyword">import</span> onpolicy_trainer</span><br><span class="line"><span class="keyword">from</span> tianshou.utils.net.common <span class="keyword">import</span> ActorCritic, Net</span><br><span class="line"><span class="keyword">from</span> tianshou.utils.net.discrete <span class="keyword">import</span> Actor, Critic</span><br><span class="line">​</span><br><span class="line"><span class="keyword">import</span> warnings</span><br><span class="line">warnings.filterwarnings(<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line">​</span><br><span class="line">device = <span class="string">&#x27;cuda&#x27;</span> <span class="keyword">if</span> torch.cuda.is_available() <span class="keyword">else</span> <span class="string">&#x27;cpu&#x27;</span></span><br><span class="line">​</span><br><span class="line">env = gym.make(<span class="string">&#x27;CartPole-v0&#x27;</span>)</span><br><span class="line">train_envs = DummyVectorEnv([<span class="keyword">lambda</span>: gym.make(<span class="string">&#x27;CartPole-v0&#x27;</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>)])</span><br><span class="line">test_envs = DummyVectorEnv([<span class="keyword">lambda</span>: gym.make(<span class="string">&#x27;CartPole-v0&#x27;</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)])</span><br><span class="line">​</span><br><span class="line"><span class="comment"># net is the shared head of the actor and the critic</span></span><br><span class="line">net = Net(env.observation_space.shape, hidden_sizes=[<span class="number">64</span>, <span class="number">64</span>], device=device)</span><br><span class="line">actor = Actor(net, env.action_space.n, device=device).to(device)</span><br><span class="line">critic = Critic(net, device=device).to(device)</span><br><span class="line">actor_critic = ActorCritic(actor, critic)</span><br><span class="line">​</span><br><span class="line"><span class="comment"># optimizer of the actor and the critic</span></span><br><span class="line">optim = torch.optim.Adam(actor_critic.parameters(), lr=<span class="number">0.0003</span>)</span><br><span class="line">​</span><br><span class="line">dist = torch.distributions.Categorical</span><br><span class="line">policy = PPOPolicy(actor, critic, optim, dist, action_space=env.action_space, deterministic_eval=<span class="literal">True</span>)</span><br><span class="line">​</span><br><span class="line">train_collector = Collector(policy, train_envs, VectorReplayBuffer(<span class="number">20000</span>, <span class="built_in">len</span>(train_envs)))</span><br><span class="line">test_collector = Collector(policy, test_envs)</span><br><span class="line">​</span><br><span class="line">result = onpolicy_trainer(</span><br><span class="line">    policy,</span><br><span class="line">    train_collector,</span><br><span class="line">    test_collector,</span><br><span class="line">    max_epoch=<span class="number">10</span>,</span><br><span class="line">    step_per_epoch=<span class="number">50000</span>,</span><br><span class="line">    repeat_per_collect=<span class="number">10</span>,</span><br><span class="line">    episode_per_test=<span class="number">10</span>,</span><br><span class="line">    batch_size=<span class="number">256</span>,</span><br><span class="line">    step_per_collect=<span class="number">2000</span>,</span><br><span class="line">    stop_fn=<span class="keyword">lambda</span> mean_reward: mean_reward &gt;= <span class="number">195</span>,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://qinghe7.github.io/2023/08/22/vue/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/saber.png">
      <meta itemprop="name" content="Qinghe">
      <meta itemprop="description" content="选择有时候比努力更重要">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Qinghe'Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/08/22/vue/" class="post-title-link" itemprop="url">My New Post</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-08-22 19:33:59" itemprop="dateCreated datePublished" datetime="2023-08-22T19:33:59+08:00">2023-08-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-08-27 20:14:46" itemprop="dateModified" datetime="2023-08-27T20:14:46+08:00">2023-08-27</time>
              </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>3.1k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>3 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>vue 响应式界面真的很棒</p>
<p><a target="_blank" rel="noopener" href="https://v2.cn.vuejs.org/v2/guide/">介绍 — Vue.js (vuejs.org)</a></p>
<h1 id="深入响应式系统深入响应式系统-Vue-js-vuejs-org"><a href="#深入响应式系统深入响应式系统-Vue-js-vuejs-org" class="headerlink" title="深入响应式系统深入响应式系统 | Vue.js (vuejs.org)"></a>深入响应式系统<a target="_blank" rel="noopener" href="https://cn.vuejs.org/guide/extras/reactivity-in-depth.html#how-reactivity-works-in-vue">深入响应式系统 | Vue.js (vuejs.org)</a></h1><p>Vue 最标志性的功能就是其低侵入性的响应式系统。组件状态都是由响应式的 JavaScript 对象组成的。当更改它们时，视图会随即自动更新。这让状态管理更加简单直观，但理解它是如何工作的也是很重要的，这可以帮助我们避免一些常见的陷阱。在本节中，我们将深入研究 Vue 响应性系统的一些底层细节。</p>
<p>这个术语在今天的各种编程讨论中经常出现，但人们说它的时候究竟是想表达什么意思呢？本质上，响应性是一种可以使我们声明式地处理变化的编程范式。一个经常被拿来当作典型例子的用例即是 Excel 表格：</p>
<table>
<thead>
<tr>
<th></th>
<th>A</th>
<th>B</th>
<th>C</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>1</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>2</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>这里单元格 A2 中的值是通过公式 <code>= A0 + A1</code> 来定义的 (你可以在 A2 上点击来查看或编辑该公式)，因此最终得到的值为 3，正如所料。但如果你试着更改 A0 或 A1，你会注意到 A2 也随即自动更新了。</p>
<p>而 JavaScript 默认并不是这样的。如果我们用 JavaScript 写类似的逻辑：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable constant_">A0</span> = <span class="number">1</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable constant_">A1</span> = <span class="number">2</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable constant_">A2</span> = <span class="variable constant_">A0</span> + <span class="variable constant_">A1</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable constant_">A2</span>) <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line"><span class="variable constant_">A0</span> = <span class="number">2</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable constant_">A2</span>) <span class="comment">// 仍然是 3</span></span><br></pre></td></tr></table></figure>

<p>当我们更改 <code>A0</code> 后，<code>A2</code> 不会自动更新。</p>
<p>那么我们如何在 JavaScript 中做到这一点呢？首先，为了能重新运行计算的代码来更新 <code>A2</code>，我们需要将其包装为一个函数</p>
<p>let A2</p>
<p>function update() {<br>  A2 &#x3D; A0 + A1<br>}</p>
<p>然后，我们需要定义几个术语：</p>
<ul>
<li>这个 <code>update()</code> 函数会产生一个<strong>副作用</strong>，或者就简称为<strong>作用</strong> (effect)，因为它会更改程序里的状态。</li>
<li><code>A0</code> 和 <code>A1</code> 被视为这个作用的<strong>依赖</strong> (dependency)，因为它们的值被用来执行这个作用。因此这次作用也可以说是一个它依赖的<strong>订阅者</strong> (subscriber)。</li>
</ul>
<p>我们需要一个魔法函数，能够在 <code>A0</code> 或 <code>A1</code> (这两个<strong>依赖</strong>) 变化时调用 <code>update()</code> (产生<strong>作用</strong>)。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">whenDepsChange</span>(update)</span><br></pre></td></tr></table></figure>

<p>这个 <code>whenDepsChange()</code> 函数有如下的任务：</p>
<ol>
<li>当一个变量被读取时进行追踪。例如我们执行了表达式 <code>A0 + A1</code> 的计算，则 <code>A0</code> 和 <code>A1</code> 都被读取到了。</li>
<li>如果一个变量在当前运行的副作用中被读取了，就将该副作用设为此变量的一个订阅者。例如由于 <code>A0</code> 和 <code>A1</code> 在 <code>update()</code> 执行时被访问到了，则 <code>update()</code> 需要在第一次调用之后成为 <code>A0</code> 和 <code>A1</code> 的订阅者。</li>
<li>探测一个变量的变化。例如当我们给 <code>A0</code> 赋了一个新的值后，应该通知其所有订阅了的副作用重新执行。</li>
</ol>
<h1 id="Vue-中的响应性是如何工作的"><a href="#Vue-中的响应性是如何工作的" class="headerlink" title="Vue 中的响应性是如何工作的"></a>Vue 中的响应性是如何工作的</h1><p>我们无法直接追踪对上述示例中局部变量的读写，原生 JavaScript 没有提供任何机制能做到这一点。<strong>但是</strong>，我们是可以追踪<strong>对象属性</strong>的读写的。</p>
<p>在 JavaScript 中有两种劫持 property 访问的方式：<a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/get">getter</a> &#x2F; <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/set">setters</a> 和 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy">Proxies</a>。Vue 2 使用 getter &#x2F; setters 完全是出于支持旧版本浏览器的限制。而在 Vue 3 中则使用了 Proxy 来创建响应式对象，仅将 getter &#x2F; setter 用于 ref。下面的伪代码将会说明它们是如何工作的：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">reactive</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Proxy</span>(obj, &#123;</span><br><span class="line">    <span class="title function_">get</span>(<span class="params">target, key</span>) &#123;</span><br><span class="line">      <span class="title function_">track</span>(target, key)</span><br><span class="line">      <span class="keyword">return</span> target[key]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">set</span>(<span class="params">target, key, value</span>) &#123;</span><br><span class="line">      target[key] = value</span><br><span class="line">      <span class="title function_">trigger</span>(target, key)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ref</span>(<span class="params">value</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> refObject = &#123;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">value</span>() &#123;</span><br><span class="line">      <span class="title function_">track</span>(refObject, <span class="string">&#x27;value&#x27;</span>)</span><br><span class="line">      <span class="keyword">return</span> value</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">set</span> <span class="title function_">value</span>(<span class="params">newValue</span>) &#123;</span><br><span class="line">      value = newValue</span><br><span class="line">      <span class="title function_">trigger</span>(refObject, <span class="string">&#x27;value&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> refObject</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上代码解释了我们在基础章节部分讨论过的一些 <a target="_blank" rel="noopener" href="https://cn.vuejs.org/guide/essentials/reactivity-fundamentals.html#limitations-of-reactive"><code>reactive()</code> 的局限性</a>：</p>
<ul>
<li>当你将一个响应式对象的属性赋值或解构到一个本地变量时，访问或赋值该变量是非响应式的，因为它将不再触发源对象上的 get &#x2F; set 代理。注意这种“断开”只影响变量绑定——如果变量指向一个对象之类的非原始值，那么对该对象的修改仍然是响应式的。</li>
<li>从 <code>reactive()</code> 返回的代理尽管行为上表现得像原始对象，但我们通过使用 <code>===</code> 运算符还是能够比较出它们的不同。</li>
</ul>
<p>在 <code>track()</code> 内部，我们会检查当前是否有正在运行的副作用。如果有，我们会查找到一个存储了所有追踪了该属性的订阅者的 Set，然后将当前这个副作用作为新订阅者添加到该 Set 中。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这会在一个副作用就要运行之前被设置</span></span><br><span class="line"><span class="comment">// 我们会在后面处理它</span></span><br><span class="line"><span class="keyword">let</span> activeEffect</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">track</span>(<span class="params">target, key</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (activeEffect) &#123;</span><br><span class="line">    <span class="keyword">const</span> effects = <span class="title function_">getSubscribersForProperty</span>(target, key)</span><br><span class="line">    effects.<span class="title function_">add</span>(activeEffect)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>副作用订阅将被存储在一个全局的 <code>WeakMap&lt;target, Map&lt;key, Set&lt;effect&gt;&gt;&gt;</code> 数据结构中。如果在第一次追踪时没有找到对相应属性订阅的副作用集合，它将会在这里新建。这就是 <code>getSubscribersForProperty()</code> 函数所做的事。为了简化描述，我们跳过了它其中的细节。</p>
<p>在 <code>trigger()</code> 之中，我们会再查找到该属性的所有订阅副作用。但这一次我们需要执行它们：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">trigger</span>(<span class="params">target, key</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> effects = <span class="title function_">getSubscribersForProperty</span>(target, key)</span><br><span class="line">  effects.<span class="title function_">forEach</span>(<span class="function">(<span class="params">effect</span>) =&gt;</span> <span class="title function_">effect</span>())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="单文件组件-Component可以理解为dom的一个标签"><a href="#单文件组件-Component可以理解为dom的一个标签" class="headerlink" title="单文件组件 Component可以理解为dom的一个标签"></a>单文件组件 Component可以理解为dom的一个标签</h1><p>Vue 的单文件组件 (即 <code>*.vue</code> 文件，英文 Single-File Component，简称 <strong>SFC</strong>) 是一种特殊的文件格式，使我们能够将一个 Vue 组件的模板、逻辑与样式封装在单个文件中。下面是一个单文件组件的示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      greeting: &#x27;Hello World!&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;p class=&quot;greeting&quot;&gt;&#123;&#123; greeting &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">.greeting &#123;</span><br><span class="line">  color: red;</span><br><span class="line">  font-weight: bold;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://qinghe7.github.io/2023/08/22/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/saber.png">
      <meta itemprop="name" content="Qinghe">
      <meta itemprop="description" content="选择有时候比努力更重要">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Qinghe'Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/08/22/hello-world/" class="post-title-link" itemprop="url">Hello World</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-08-22 19:16:28" itemprop="dateCreated datePublished" datetime="2023-08-22T19:16:28+08:00">2023-08-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-08-30 14:05:52" itemprop="dateModified" datetime="2023-08-30T14:05:52+08:00">2023-08-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%B5%8B%E8%AF%95/" itemprop="url" rel="index"><span itemprop="name">测试</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>63</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 测试代码块</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br></pre></td></tr></table></figure>



<p>测试md文件</p>
<p><strong>23年8月22日记</strong></p>
<h2 id="helloword"><a href="#helloword" class="headerlink" title="helloword"></a>helloword</h2><p>初始化博客</p>
<p>后续博客美化持续进行中</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Qinghe"
      src="/images/saber.png">
  <p class="site-author-name" itemprop="name">Qinghe</p>
  <div class="site-description" itemprop="description">选择有时候比努力更重要</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">5</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>
  <div class="sidebar-button motion-element"><i class="fa fa-comment"></i>
    Chat
  </a>
  </div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/qinghe7" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;qinghe7" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Qinghe</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">24k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">22 分钟</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

  

</body>
</html>
